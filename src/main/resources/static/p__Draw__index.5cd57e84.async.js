"use strict";(self.webpackChunkmidjourney_proxy_pool_admin=self.webpackChunkmidjourney_proxy_pool_admin||[]).push([[903],{39936:function(Hr,se,t){t.r(se),t.d(se,{default:function(){return Ke}});var Re=t(97857),x=t.n(Re),Be=t(15009),S=t.n(Be),De=t(96695),U=t.n(De),Ue=t(19632),Le=t.n(Ue),Oe=t(99289),N=t.n(Oe),ke=t(5574),p=t.n(ke),Me=t(90930),w=t(96365),G=t(4393),Je=t(57959),g=t(2453),Ne=t(7134),$=t(86250),F=t(42075),we=t(66309),Ge=t(32545),$e=t(75081),Ye=t(13275),T=t(15867),V=t(66476),te=t(78045),ze=t(34041),He=t(98366),d=t(67294),Q=t(88484),Ve=t(29273),ne={cardTitleTime:"cardTitleTime___ULudn",taskErrorTip:"taskErrorTip___EJ9yV"},Z=t(66927),r=t(85893),Qe=w.Z.TextArea,We=G.Z.Meta,Xe=function(){var qe=Je.Z.useNotification(),ie=p()(qe,2),R=ie[0],_e=ie[1],er=(0,d.useState)([]),ue=p()(er,2),rr=ue[0],le=ue[1],ar=(0,d.useState)(!1),oe=p()(ar,2),sr=oe[0],de=oe[1],tr=(0,d.useState)("imagine"),ce=p()(tr,2),c=ce[0],nr=ce[1],ir=(0,d.useState)("MID_JOURNEY"),fe=p()(ir,2),L=fe[0],ur=fe[1],lr=(0,d.useState)(""),pe=p()(lr,2),b=pe[0],O=pe[1],or=(0,d.useState)("SQUARE"),me=p()(or,2),ve=me[0],dr=me[1],cr=(0,d.useState)([]),ge=p()(cr,2),B=ge[0],k=ge[1],fr=(0,d.useState)(""),he=p()(fr,2),pr=he[0],ye=he[1],mr=(0,d.useState)(!1),je=p()(mr,2),M=je[0],P=je[1],vr=(0,d.useState)(new Set),gr=p()(vr,1),v=gr[0],hr=(0,d.useState)(!1),Se=p()(hr,2),yr=Se[0],Y=Se[1],jr=(0,d.useState)(""),Te=p()(jr,2),Sr=Te[0],Tr=Te[1],br=(0,d.useState)(""),be=p()(br,2),Ce=be[0],Ze=be[1],Cr=(0,d.useState)(""),Pe=p()(Cr,2),Zr=Pe[0],Pr=Pe[1],Ar=(0,d.useState)(!1),Ae=p()(Ar,2),Er=Ae[0],Ee=Ae[1],W=(0,d.useRef)([]),D="midjourney-proxy-admin",Ir=sessionStorage.getItem("mj-image-prefix")||"",X;(0,d.useEffect)(function(){Rr({state:D,pageNumber:0,pageSize:3,sort:"submitTime,desc"}),X!=null&&clearInterval(X),X=setInterval(function(){v.size!=0&&xr()},2e3)},[]);var xr=function(){var n=N()(S()().mark(function e(){var s,l,o,m,u,f,h,y,I,E,J,re;return S()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return s=Array.from(v),l=new Set(s),i.next=4,(0,Z.BX)(s);case 4:o=i.sent,m=o.content,u=!1,f=Le()(W.current),h=U()(m),i.prev=9,I=S()().mark(function j(){var C,H;return S()().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:C=y.value,l.delete(C.id),(C.status==="FAILURE"||C.status==="SUCCESS")&&v.delete(C.id),H=f.find(function(zr){return zr.id===C.id}),H?Fr(H,C)||(u=!0,f.splice(f.indexOf(H),1,C)):(u=!0,f.push(C));case 5:case"end":return ae.stop()}},j)}),h.s();case 12:if((y=h.n()).done){i.next=16;break}return i.delegateYield(I(),"t0",14);case 14:i.next=12;break;case 16:i.next=21;break;case 18:i.prev=18,i.t1=i.catch(9),h.e(i.t1);case 21:return i.prev=21,h.f(),i.finish(21);case 24:E=U()(l);try{for(E.s();!(J=E.n()).done;)re=J.value,v.delete(re)}catch(j){E.e(j)}finally{E.f()}u&&(W.current=f,le(f),Ie());case 27:case"end":return i.stop()}},e,null,[[9,18,21,24]])}));return function(){return n.apply(this,arguments)}}(),Fr=function(e,s){return e.status===s.status&&e.progress===s.progress&&e.imageUrl===s.imageUrl},Ie=function(){setTimeout(function(){var e=document.getElementById("task-panel");e&&e.scrollTo(0,e.scrollHeight)},20)},Rr=function(){var n=N()(S()().mark(function e(s){var l,o,m,u,f;return S()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return de(!0),y.next=3,(0,Z.Pn)(s);case 3:l=y.sent,o=l.content.reverse(),m=U()(o);try{for(m.s();!(u=m.n()).done;)f=u.value,f.status!=="FAILURE"&&f.status!=="SUCCESS"&&v.add(f.id)}catch(I){m.e(I)}finally{m.f()}W.current=o,le(o),de(!1),Ie();case 11:case"end":return y.stop()}},e)}));return function(s){return n.apply(this,arguments)}}(),Br=function(e){nr(e),O(""),k([])},Dr=function(e){var s=e.target.value;ur(s)},Ur=function(e){var s=e.target.value;dr(s)},K=function(e){O(e.target.value)},Lr=function(e){Ze(e.target.value)},q=function(){var n=N()(S()().mark(function e(s){return S()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,new Promise(function(m){var u=new FileReader;u.onload=function(f){return m(u.result)},u.readAsDataURL(s)});case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}},e)}));return function(s){return n.apply(this,arguments)}}(),A=function(){var n=N()(S()().mark(function e(){var s,l,o,m,u,f,h,y,I,E,J;return S()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(c!=="show"){a.next=8;break}if(b){a.next=4;break}return g.ZP.error("\u4EFB\u52A1ID\u4E0D\u80FD\u4E3A\u7A7A!"),a.abrupt("return");case 4:v.add(b),O(""),a.next=84;break;case 8:if(c!=="imagine"){a.next=36;break}if(b){a.next=12;break}return g.ZP.error("prompt\u4E0D\u80FD\u4E3A\u7A7A!"),a.abrupt("return");case 12:P(!0),s=[],l=U()(B),a.prev=15,l.s();case 17:if((o=l.n()).done){a.next=25;break}return m=o.value,a.next=21,q(m.originFileObj);case 21:u=a.sent,s.push(u);case 23:a.next=17;break;case 25:a.next=30;break;case 27:a.prev=27,a.t0=a.catch(15),l.e(a.t0);case 30:return a.prev=30,l.f(),a.finish(30);case 33:(0,Z.qJ)(c,{botType:L,prompt:b,base64Array:s,state:D}).then(function(i){P(!1);var j=z(i);j&&(v.add(i.result),O(""),k([]))}),a.next=84;break;case 36:if(c!=="blend"){a.next=64;break}if(!(B.length<2)){a.next=40;break}return g.ZP.error("blend\u81F3\u5C11\u9700\u8981\u4E24\u5F20\u56FE\u7247!"),a.abrupt("return");case 40:P(!0),f=[],h=U()(B),a.prev=43,h.s();case 45:if((y=h.n()).done){a.next=53;break}return I=y.value,a.next=49,q(I.originFileObj);case 49:E=a.sent,f.push(E);case 51:a.next=45;break;case 53:a.next=58;break;case 55:a.prev=55,a.t1=a.catch(43),h.e(a.t1);case 58:return a.prev=58,h.f(),a.finish(58);case 61:(0,Z.qJ)(c,{botType:L,base64Array:f,dimensions:ve,state:D}).then(function(i){P(!1);var j=z(i);j&&(v.add(i.result),k([]))}),a.next=84;break;case 64:if(c!=="describe"){a.next=75;break}if(!(B.length<1)){a.next=68;break}return g.ZP.error("\u56FE\u7247\u4E0D\u80FD\u4E3A\u7A7A!"),a.abrupt("return");case 68:return P(!0),a.next=71,q(B[0].originFileObj);case 71:J=a.sent,(0,Z.qJ)(c,{botType:L,base64:J,state:D}).then(function(i){P(!1);var j=z(i);j&&(v.add(i.result),k([]))}),a.next=84;break;case 75:if(c!=="shorten"){a.next=83;break}if(b){a.next=79;break}return g.ZP.error("prompt\u4E0D\u80FD\u4E3A\u7A7A!"),a.abrupt("return");case 79:P(!0),(0,Z.qJ)(c,{botType:L,prompt:b,state:D}).then(function(i){P(!1);var j=z(i);j&&(v.add(i.result),O(""))}),a.next=84;break;case 83:g.ZP.error("\u5F53\u524D\u9875\u6682\u4E0D\u652F\u6301\u8BE5\u6307\u4EE4!");case 84:case"end":return a.stop()}},e,null,[[15,27,30,33],[43,55,58,61]])}));return function(){return n.apply(this,arguments)}}(),z=function(e){return e.code==22||e.code==1?(e.code==22?R.warning({message:"warn",description:e.description}):g.ZP.success("\u63D0\u4EA4\u4EFB\u52A1\u6210\u529F\uFF0C\u8BF7\u7A0D\u7B49..."),!0):(R.error({message:"error",description:e.description}),!1)},Or=function(e,s){var l=s.customId;if(l.startsWith("MJ::Inpaint:")){g.ZP.error("\u5F53\u524D\u9875\u6682\u4E0D\u652F\u6301\u5C40\u90E8\u91CD\u7ED8!");return}var o=e.id,m=s.emoji+" "+s.label;ye(o+":"+l),(0,Z.qJ)("action",{taskId:o,customId:l,state:D}).then(function(u){ye(""),u.code==22?(R.warning({message:"warn",description:u.description}),s.style=3,v.add(u.result)):u.code==21?(s.style=3,Tr(u.result+" "+m),Pr(u.result),Ze(u.properties.finalPrompt),Y(!0)):u.code==1?(s.style=3,v.add(u.result),g.ZP.success("\u52A8\u4F5C\u6267\u884C\u6210\u529F\uFF0C\u8BF7\u7A0D\u7B49...")):R.error({message:"error",description:u.description})})},kr=function(){Ee(!0),(0,Z.qJ)("modal",{taskId:Zr,prompt:Ce}).then(function(e){Ee(!1),e.code==22?(R.warning({message:"warn",description:e.description}),v.add(e.result),Y(!1)):e.code==1?(v.add(e.result),Y(!1),g.ZP.success("\u63D0\u4EA4\u6210\u529F\uFF0C\u8BF7\u7A0D\u7B49...")):R.error({message:"error",description:e.description})})},Mr=function(){return rr.map(function(e){return(0,r.jsxs)(G.Z,{bordered:!1,bodyStyle:{backgroundColor:"rgba(17,20,24,.15)",marginBottom:"10px"},children:[(0,r.jsx)(We,{avatar:(0,r.jsx)(Ne.C,{src:e.properties.botType=="NIJI_JOURNEY"?"./niji.webp":"./midjourney.webp"}),title:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:e.properties.botType=="NIJI_JOURNEY"?"niji\u30FBjourney":"Midjourney"}),(0,r.jsx)("span",{className:ne.cardTitleTime,children:e.displays.submitTime})]}),description:e.description}),(0,r.jsxs)($.Z,{vertical:!0,style:{marginTop:"10px"},children:[Jr(e),(0,r.jsx)(F.Z,{wrap:!0,style:{marginTop:"7px"},children:wr(e)})]})]},e.id)})},Jr=function(e){return e.action=="DESCRIBE"?(0,r.jsxs)(r.Fragment,{children:[_(e)," ",xe(e)," ",Fe(e.imageUrl,120)]}):e.action=="SHORTEN"?(0,r.jsxs)(r.Fragment,{children:[_(e)," ",xe(e)]}):(0,r.jsxs)(r.Fragment,{children:[_(e),Fe(e.imageUrl,250)]})},xe=function(e){return e.properties.finalPrompt?(0,r.jsx)(Ve.U,{children:e.properties.finalPrompt}):(0,r.jsx)(r.Fragment,{})},_=function(e){if(e.status=="FAILURE")return(0,r.jsx)("span",{className:ne.taskErrorTip,children:e.failReason});if(e.status=="SUCCESS")return(0,r.jsx)(r.Fragment,{});if(e.status=="IN_PROGRESS")return Nr(e.progress);var s=e.status=="SUBMITTED"?"lime":e.status=="MODAL"?"warning":"purple";return(0,r.jsxs)("span",{children:["\u5F53\u524D\u72B6\u6001 ",(0,r.jsx)(we.Z,{style:{marginLeft:"5px"},color:s,children:e.displays.status})]})},Fe=function(e,s){return e?(0,r.jsx)(Ge.Z,{width:s,src:Ir+e,placeholder:(0,r.jsx)($e.Z,{tip:"Loading",size:"large"})}):(0,r.jsx)(r.Fragment,{})},Nr=function(e){var s=0;return e&&e.indexOf("%")>0&&(s=parseInt(e.substring(0,e.indexOf("%")))),(0,r.jsx)("div",{style:{width:250},children:(0,r.jsx)(Ye.Z,{style:{marginLeft:"5px"},percent:s,status:"normal"})})},wr=function(e){return e.buttons.map(function(s){return(0,r.jsxs)(T.ZP,{ghost:!0,style:{backgroundColor:s.style==3?"#258146":"rgb(131 133 142)"},onClick:function(){Or(e,s)},loading:pr==e.id+":"+s.customId,children:[s.emoji," ",s.label]},e.id+":"+s.customId)})},Gr=function(){return c=="show"?(0,r.jsxs)(F.Z.Compact,{style:{width:"100%"},children:[(0,r.jsx)(w.Z,{placeholder:"\u8F93\u5165\u4EFB\u52A1ID, \u8C03\u51FA\u672A\u5C55\u793A\u7684\u4EFB\u52A1",value:b,onChange:K,onPressEnter:A}),(0,r.jsx)(T.ZP,{type:"primary",onClick:A,loading:M,children:"\u63D0\u4EA4\u4EFB\u52A1"})]}):c=="imagine"?(0,r.jsxs)($.Z,{vertical:!0,children:[(0,r.jsx)(V.Z,x()(x()({},ee),{},{children:(0,r.jsx)(T.ZP,{icon:(0,r.jsx)(Q.Z,{}),children:"\u4E0A\u4F20\u57AB\u56FE"})})),(0,r.jsxs)(F.Z.Compact,{style:{width:"100%",marginTop:"10px"},children:[(0,r.jsx)(w.Z,{placeholder:"Prompt",value:b,onChange:K,onPressEnter:A}),(0,r.jsx)(T.ZP,{type:"primary",onClick:A,loading:M,children:"\u63D0\u4EA4\u4EFB\u52A1"})]})]}):c=="blend"?(0,r.jsxs)($.Z,{vertical:!0,children:[(0,r.jsx)(V.Z,x()(x()({},ee),{},{children:(0,r.jsx)(T.ZP,{icon:(0,r.jsx)(Q.Z,{}),children:"\u4E0A\u4F20\u56FE\u7247"})})),(0,r.jsxs)(F.Z,{style:{width:"100%",marginTop:"10px"},children:[(0,r.jsx)(te.ZP.Group,{value:ve,onChange:Ur,options:[{value:"PORTRAIT",label:"\u8096\u50CF(2:3)"},{value:"SQUARE",label:"\u6B63\u65B9\u5F62(1:1)"},{value:"LANDSCAPE",label:"\u666F\u89C2(3:2)"}],optionType:"button"}),(0,r.jsx)(T.ZP,{type:"primary",onClick:A,loading:M,children:"\u63D0\u4EA4\u4EFB\u52A1"})]})]}):c=="describe"?(0,r.jsxs)($.Z,{vertical:!0,children:[(0,r.jsx)(V.Z,x()(x()({},ee),{},{children:(0,r.jsx)(T.ZP,{icon:(0,r.jsx)(Q.Z,{}),children:"\u4E0A\u4F20\u56FE\u7247"})})),(0,r.jsx)(T.ZP,{style:{marginTop:"10px"},type:"primary",onClick:A,loading:M,children:"\u63D0\u4EA4\u4EFB\u52A1"})]}):c=="shorten"?(0,r.jsxs)(F.Z.Compact,{style:{width:"100%",marginTop:"10px"},children:[(0,r.jsx)(w.Z,{placeholder:"Prompt",value:b,onChange:K,onPressEnter:A}),(0,r.jsx)(T.ZP,{type:"primary",onClick:A,loading:M,children:"\u63D0\u4EA4\u4EFB\u52A1"})]}):(0,r.jsx)(r.Fragment,{})};function $r(n){n.onSuccess()}var Yr=function(e){var s=e.type==="image/jpeg"||e.type==="image/png";s||g.ZP.error("\u53EA\u80FD\u4E0A\u4F20JPG\u6216PNG\u6587\u4EF6!");var l=e.size/1024/1024<2;return l||g.ZP.error("\u56FE\u7247\u5927\u5C0F\u9700\u5C0F\u4E8E2MB!"),s&&l},ee={customRequest:$r,beforeUpload:Yr,fileList:B,maxCount:c=="blend"||c=="imagine"?5:1,onChange:function(e){k(e.fileList)}};return(0,r.jsxs)(Me._z,{children:[_e,(0,r.jsx)(G.Z,{style:{marginBottom:"15px",overflow:"auto",height:"70vh"},loading:sr,id:"task-panel",children:Mr()}),(0,r.jsxs)(G.Z,{children:[(0,r.jsxs)(F.Z,{style:{marginBottom:"10px"},children:[(0,r.jsx)(ze.Z,{value:c,style:{width:150},onChange:Br,options:[{value:"imagine",label:"/imagine"},{value:"blend",label:"/blend"},{value:"describe",label:"/describe"},{value:"shorten",label:"/shorten"},{value:"show",label:"/show"}]}),(0,r.jsx)(te.ZP.Group,{value:L,onChange:Dr,options:[{value:"MID_JOURNEY",label:"Midjourney"},{value:"NIJI_JOURNEY",label:"niji\u30FBjourney"}],optionType:"button"})]}),Gr()]}),(0,r.jsx)(He.Z,{title:Sr,open:yr,onCancel:function(){return Y(!1)},onOk:kr,confirmLoading:Er,width:600,children:(0,r.jsx)(Qe,{rows:3,value:Ce,onChange:Lr})})]})},Ke=Xe}}]);
